define(["audioTpl","lyrics","utils"],function(e,n,t){document.body.innerHTML=e.audioTpl;var i=[];$.ajax({async:!1,url:"js/playList.json",success:function(e){i=e}});var r=document.getElementById("audio1"),o=document.getElementById("songName"),l=document.getElementById("artist"),c=document.querySelector(".center .play_needle"),s=document.querySelector(".bg"),a=document.querySelector(".disk"),u=document.querySelector(".disk .disk-album-bg"),d=document.getElementById("total-time"),m=document.getElementById("currentTime"),y=document.querySelectorAll("#control span"),p=document.querySelector("#play-list"),g=document.getElementById("playListCount"),S=document.querySelector("#play-list ul"),f=document.getElementById("list-mask"),h=document.querySelector("#play-list .list-title-close"),T={duration:0,song:"",singer:"",src:"",img:"",lyric:"",playing:!1,loopmodel:0,curtime:0,perSecTimer:null,perSecArrFn:[],percent:0,curDraging:!1,ended:!1,songCount:0,nowSong:0,buffered:0,listState:!1};function b(e,n){for(var t=e.className.split(" "),i=!0,r=0;r<t.length;r++)t[r]===n&&(i=!1,t.splice(r,1),r--);return i&&t.push(n),e.className=t.join(" "),e.className}return T.init=function(){T.loaddata(T.nowSong),T.load(),T.getTotalTime()},T.loaddata=function(e){this.song=i[e].song,this.singer=i[e].singer,this.src=i[e].src,this.img=i[e].img,this.songCount=i.length,i[e].lyric&&(this.lyric=i[e].lyric)},T.load=function(){this.src&&this.song&&this.singer&&(r.src=this.src,o.innerHTML=this.song,l.innerHTML=this.singer,s.style.backgroundImage="url("+this.img+")",u.src=this.img,g.innerHTML=this.songCount)},T.getTotalTime=function(){var e=0,n=setInterval(function(){e++,r.duration&&1<r.duration&&(clearInterval(n),T.duration=r.duration,d.innerHTML=t.SecToMin(T.duration)),800<e&&(e=0,alert("歌曲加载超时!"))},20)},T.getCurTime=function(){r.currentTime&&!this.curDraging&&(T.curtime=r.currentTime,m.innerHTML=t.SecToMin(T.curtime))},T.perSec=function(){clearInterval(this.perSecTimer),this.perSecTimer=setInterval(function(){for(var e=0;e<T.perSecArrFn.length;e++)"function"==typeof T.perSecArrFn[e]&&T.perSecArrFn[e].call(T)},1e3)},T.play=function(){r.play(),a.style.WebkitAnimationPlayState="running"},T.pause=function(){r.pause(),a.style.WebkitAnimationPlayState="paused"},T.playList=function(){for(var e=0;e<i.length;e++){var n=document.createElement("li"),t=document.createElement("span");e==T.nowSong&&(n.className="active"),n.index=e,n.innerHTML=i[e].song,t.innerHTML="&nbsp;&nbsp;-"+i[e].singer,n.appendChild(t),S.appendChild(n)}},T.perSecArrFn.push(T.getCurTime),T.playList(),y[2].onclick=function(){if(0==r.readyState)return!1;T.play(),T.getCurTime(),y[2].style.display="none",y[3].style.display="inline-block",b(c,"stop"),T.perSec()},y[3].onclick=function(){T.pause(),y[2].style.display="inline-block",y[3].style.display="none",b(c,"stop")},y[5].onclick=function(){S.scrollTop=42*(T.nowSong-2),t.doMove(p,{bottom:0},150,"linear"),T.listState=!1,f.style.display="block"},h.onclick=function(){t.doMove(p,{bottom:-360},150,"linear"),T.listState=!0,f.style.display="none"},T});